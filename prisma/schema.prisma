generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

model PortalUser {
  email               String              @id
  descopeSub          String?             @map("descope_sub")
  displayName         String?             @map("display_name")
  currentPlan         PlanTier?           @map("current_plan")
  availableCreditsCents Int               @default(0) @map("available_credits_cents")
  lifetimeCreditsCents Int                @default(0) @map("lifetime_credits_cents")
  monthlyBudgetCents  Int                 @default(0) @map("monthly_budget_cents")
  monthlySpentCents   Int                 @default(0) @map("monthly_spent_cents")
  createdAt           DateTime            @default(now()) @map("created_at")
  updatedAt           DateTime            @updatedAt @map("updated_at")
  creditTransactions  CreditTransaction[]

  @@map("portal_users")
}

model CreditTransaction {
  id         String                @id @default(cuid())
  userEmail  String                @map("user_email")
  amountCents Int                  @map("amount_cents")
  type       CreditTransactionType
  planTier   PlanTier?             @map("plan_tier")
  creditsAddedCents Int            @default(0) @map("credits_added_cents")
  note       String?
  createdAt  DateTime              @default(now()) @map("created_at")

  user PortalUser @relation(fields: [userEmail], references: [email], onDelete: Cascade)

  @@index([userEmail])
  @@map("credit_transactions")
}

enum CreditTransactionType {
  PLAN_PURCHASE
  MOCK_PURCHASE
  ADJUSTMENT
}

enum PlanTier {
  PRO
  GROWTH
  SCALE
}
